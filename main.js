(()=>{"use strict";function t(t,e,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image"),u=c.querySelector(".card__title"),i=c.querySelector(".card__delete-button"),l=c.querySelector(".card__like-button"),s=c.querySelector(".card__like-button-counter");return u.textContent=t.name,a.src=t.link,a.alt=t.name,s.textContent=t.likes.length||0,i.addEventListener("click",function(n){e(n,t._id)}),a.addEventListener("click",n),l.addEventListener("click",function(e){o(e,t._id)}),t.owner._id!==r&&i.remove(),t.likes.some(function(t){return t._id===r})&&l.classList.add("card__like-button_is-active"),c}function e(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",r)}function n(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}function o(t){t.target.classList.contains("popup_is-opened")&&n(t.target)}function r(t){"Escape"===t.key&&n(document.querySelector(".popup_is-opened"))}function c(t,e,n){var o=t.querySelector(".".concat(e.name,"-error"));e.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}function a(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach(function(n){n.setCustomValidity(""),c(t,n,e)}),u(t.querySelector(e.submitButtonSelector),e)}function u(t,e){t.disable=!0,t.classList.add(e.inactiveButtonClass)}var i={baseUrl:"https://nomoreparties.co/v1/wff-cohort-42",headers:{authorization:"0ecabfe2-6856-4cfb-a569-579a6d23d6aa","Content-Type":"application/json"}};function l(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function s(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.method,o=void 0===n?"GET":n,r=e.headers,c=void 0===r?i.headers:r,a=e.body,u={method:o,headers:c};return a&&(u.body=JSON.stringify(a)),fetch("".concat(i.baseUrl).concat(t),u).then(l)}function d(t){return s("/cards/likes/".concat(t),{method:"PUT"})}function p(t){return s("/cards/likes/".concat(t),{method:"DELETE"})}var f=document.querySelector(".places__list"),m=document.querySelector(".profile__title"),_=document.querySelector(".profile__description"),y=document.querySelector(".profile__image"),v=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),S=document.querySelector(".popup_type_image"),h=S.querySelector(".popup__image"),g=S.querySelector(".popup__caption"),q=document.querySelector(".popup_type_edit"),C=document.forms["edit-profile"],E=C.querySelector(".popup__input_type_name"),k=C.querySelector(".popup__input_type_description"),L=document.querySelectorAll(".popup__close"),x=document.querySelectorAll(".popup"),A=document.querySelector(".popup_type_new-card"),w=document.forms["new-place"],T=w.querySelector(".popup__input_type_card-name"),j=w.querySelector(".popup__input_type_url"),B=document.querySelector(".popup_type_edit-avatar"),P=document.forms["edit-avatar"],D=P.querySelector(".popup__input_type_avatar-url"),I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var M=null;function U(t,e){(t.target.classList.contains("card__like-button_is-active")?p:d)(e).then(function(e){t.target.closest(".card").querySelector(".card__like-button-counter").textContent=e.likes.length,t.target.classList.toggle("card__like-button_is-active")}).catch(function(t){console.log(t)})}function V(t,e){(function(t){return s("/cards/".concat(t),{method:"DELETE"})})(e).then(function(){!function(t){t.target.closest(".card").remove()}(t)}).catch(function(t){console.log(t)})}function H(t){h.src=t.target.src,h.alt=t.target.alt,g.textContent=t.target.alt,e(S)}Promise.all([s("/cards"),s("/users/me")]).then(function(e){var n,o,r=(o=2,function(t){if(Array.isArray(t))return t}(n=e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(u.push(o.value),u.length!==e);i=!0);}catch(t){l=!0,r=t}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return u}}(n,o)||function(t,e){if(t){if("string"==typeof t)return O(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(t,e):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=r[0],a=r[1];M=a._id,m.textContent=a.name,_.textContent=a.about,y.style.backgroundImage="url('".concat(a.avatar,"')"),c.forEach(function(e){var n=t(e,V,H,U,M);f.append(n)})}).catch(function(t){console.log(t)}),function(t){document.querySelectorAll(t.formSelector).forEach(function(e){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach(function(r){r.addEventListener("input",function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?c(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.name,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(e,r,t),function(t,e,n){!function(t){return t.some(function(t){return!t.validity.valid})}(t)?(e.disable=!1,e.classList.remove(n.inactiveButtonClass)):u(e,n)}(n,o,t)})})})}(I),v.addEventListener("click",function(){E.value=m.textContent,k.value=_.textContent,a(C,I),e(q)}),b.addEventListener("click",function(){w.reset(),a(w,I),e(A)}),y.addEventListener("click",function(){P.reset(),a(P,I),e(B)}),x.forEach(function(t){t.addEventListener("click",o),L.forEach(function(e){e.addEventListener("click",function(){n(t)})})}),C.addEventListener("submit",function(t){var e,o;t.preventDefault(),t.submitter.textContent="Сохранение...",(e=E.value,o=k.value,s("/users/me",{method:"PATCH",body:{name:e,about:o}})).then(function(t){m.textContent=t.name,_.textContent=t.about,n(q)}).catch(function(t){console.log(t)}).finally(function(){t.submitter.textContent="Сохранить"})}),w.addEventListener("submit",function(e){var o;e.preventDefault(),e.submitter.textContent="Создание...",(o={name:T.value,link:j.value},s("/cards",{method:"POST",body:{name:o.name,link:o.link}})).then(function(e){var o=t(e,V,H,U,M);f.prepend(o),n(A),w.reset()}).catch(function(t){console.log(t)}).finally(function(){e.submitter.textContent="Создать"})}),P.addEventListener("submit",function(t){t.preventDefault(),t.submitter.textContent="Сохранение...",function(t){return s("/users/me/avatar",{method:"PATCH",body:{avatar:t}})}(D.value).then(function(t){y.style.backgroundImage="url('".concat(t.avatar,"')"),n(B),P.reset()}).catch(function(t){console.log(t)}).finally(function(){t.submitter.textContent="Сохранить"})})})();